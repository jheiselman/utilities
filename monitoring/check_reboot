#!/bin/bash

SCRIPT_PATH=$(dirname $(realpath $BASH_SOURCE))

. "$SCRIPT_PATH/common.sh"

OS_TYPE=
if [[ -e /etc/os-release ]]; then
  . /etc/os-release
  if [[ -n ID_LIKE ]]; then
    OS_TYPE=$ID_LIKE
  fi
fi 

case "$OS_TYPE" in
"rhel fedora")
  latest_kernel=$(rpm -q kernel --last |awk '{print $4" "$3"\t"$1}' |sort -M |awk '{print $3}' |tail -1)
  running_kernel=$(uname -r)

  if [[ "$latest_kernel" != "$running_kernel" ]]; then
    echo "BAD;Reboot required"
  else
    echo "OK;No reboot required"
  fi
  ;;
"debian")
  if [[ -e /var/run/reboot-required ]]; then
    echo "BAD;Reboot required"
  else
    echo "OK;No reboot required"
  fi
  ;;
*)
  echo "Couldn't determine OS Type" >&2
  exit 1
esac
